<!DOCTYPE html>
<html lang="es">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <title>DDC - Aval</title>

    <!-- Bootstrap core CSS-->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Page level plugin CSS-->
    <link href="css/datatables.min.css" rel="stylesheet">
    <link href="css/select2.min.css" rel="stylesheet">
    <link href="css/select2-bootstrap4.min.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin.css" rel="stylesheet">

    <!-- importing style for drag and drop -->
    <link rel = "stylesheet"
          type = "text/css"
          href = "css/dragDrop.css" />

  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand navbar-dark bg-dark static-top">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">
         <img class="logo" src=".../../img/logos/log_uc_2.png">
        </a>
      <a class="navbar-brand mr-1" href="index.html"></a>

      <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Navbar Search -->


      <!-- Navbar -->
      <ul class="navbar-nav ml-auto ml-md-0">
        <li class="nav-item dropdown no-arrow mx-1">
          <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item dropdown no-arrow mx-1">
          <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="messagesDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item dropdown no-arrow">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user-circle fa-fw"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <button class="btn btn-link btn-sm order-1 order-sm-0" id="temaToggle" href="#">
              <i class="fas fa-bars">Cambiar apariencia</i>
            </button>
            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Desconectarse</a>
          </div>
        </li>
      </ul>

    </nav>

    <div id="wrapper">

      <!-- Sidebar -->
      <ul class="sidebar navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="/dashboard">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Inicio</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/enviarSolicitudAval">
            <i class="fas fa-fw fa-plus-square"></i>
            <span>Solicitar Aval</span>
          </a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/enviarSolicitudAsesoria">
            <i class="fas fa-fw fa-plus-square"></i>
            <span>Solicitar Asesoría</span>
          </a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/enviarSolicitudInvestigacion">
            <i class="fas fa-fw fa-plus-square"></i>
            <span>Solicitar Investigación</span>
          </a>
        </li>
         <li class="nav-item active">
          <a class="nav-link" href="/Reporte">
            <i class="fas fa-fw fa-plus-square"></i>
            <span>Reportes</span>
          </a>
        </li>
        <li class="nav-item active">
         <a class="nav-link" href="#" data-toggle="modal" data-target="#logoutModal">
           <i class="fas fa-fw fa-sign-out-alt"></i>
           <span>Salir</span>
         </a>
       </li>
      </ul>

      <div id="content-wrapper">

        <div class="container-fluid">


          <!-- Page Content -->
          <h1>Enviar solicitud de Aval</h1>
          <hr>
          <form method="post" id="myForm" action="/uploadSolicicitudAval" enctype="multipart/form-data">

            <div class="form-row">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <label class="input-group-text" for="tipo">Solicitud</label>
                </div>
                <select required name="solicitud" class="custom-select" id="solicitud">
                  <option value="">Seleccione...</option>
                  <option value="1">Creación</option>
                  <option value="2">Rediseño</option>
                  <option value="3">Acreditación</option>
                  <option value="4">Renovación</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <label class="input-group-text" for="tipo">Tipo</label>
                </div>
                <select required name="tipo" class="custom-select" id="tipo">
                  <option value="">Seleccione...</option>
                  <option value="1">Carrera (Pregrado, TSU, ...)</option>
                  <option value="2">Programa de Postgrado</option>
                  <option value="3">Programa de Formación Continua y Permanente</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <div class="form-label-group">
                <input required type="text" id="nombreSolicitud" class="form-control" placeholder="Nombre del Proyecto" name="nombreSolicitud">
                <label for="nombreSolicitud">Razón de la solicitud</label>
              </div>
            </div>
            <div class="form-group">
              <label for="descripcion">Descripción</label>
              <textarea class="form-control" rows="5" id="descripcion" name="descripcion"></textarea>
            </div>
            <hr>
            <label>Datos Solicitante</label>
            <!--
            <div class="form-group form-row">
              <div class="input-group-prepend">
                <label class="input-group-text">Nacionalidad</label>
              </div>
              <div class="">
                <select required id="nacionalidad" name="nacionalidad" class="custom-select">
                  <option value="">...</option>
                  <option value="V">V</option>
                  <option value="E">E</option>
                </select>
              </div>
              <div class="">
                <input required type="number" id="cedula" class="form-control" name="cedula" placeholder="Ingrese cédula" >
              </div>
              <button type="button" id="buscarPersona" class="btn btn-link">Buscar Persona</button>
            </div>
            -->
            <div class="form-group">
              <div class="form-label-group">
                <input required type="text" id="institucion" class="form-control" placeholder="institucion"   name="institucion">
                <label for="institucion">Institución</label>
              </div>
            </div>
            <div class="form-group">
              <div class="form-label-group">
                <input required type="text" id="dependencia" class="form-control" placeholder="dependencia"   name="dependencia">
                <label for="dependencia">Dependencia</label>
              </div>
            </div>
            <hr>
            <label>Datos de proponentes</label>
            <div class="form-group">
              <div class="form-group form-row">
                <div class="input-group-prepend">
                  <label class="input-group-text">Nacionalidad</label>
                </div>
                <div class="">
                  <select id="coordinadorNAC" name="nacionalidad" class="custom-select">
                    <option value="">...</option>
                    <option value="V">V</option>
                    <option value="E">E</option>
                  </select>
                </div>
                <div class="">
                  <input type="number" id="coordinadorCI" class="form-control" name="cedula" placeholder="Ingrese cédula" >
                </div>
                <button type="button" id="buscarCoordinador" class="btn btn-link fa fa-search"> Buscar coordinador</button>
              </div>
              <div class="form-label-group">
                <input type="text" id="coordinador" class="form-control" placeholder="Coordinador"   name="coordinador">
                <label for="coordinador">Coordinado por:</label>
              </div>
              <!-- boton para anhadir Coordinador -->
              <button type="button" class="btn btn-primary" onclick="addTable('c')">Agregar Diseñador</button>
              <!-- Tabla de Coordinadores involucrados -->
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th scope="col">cedula</th>
                      <th scope="col">Nombre y Apellido</th>
                      <th scope="col">opciones</th>
                    </tr>
                  </thead>
                  <tbody id="tabla-Coordinador">
                   
                  </tbody>
                </table>
              </div>
            </div>
            <div class="form-group">
              <div class="form-group form-row">
                <div class="input-group-prepend">
                  <label class="input-group-text">Nacionalidad</label>
                </div>
                <div class="">
                  <select id="disennadorNAC" name="nacionalidad" class="custom-select">
                    <option value="">...</option>
                    <option value="V">V</option>
                    <option value="E">E</option>
                  </select>
                </div>
                <div class="">
                  <input type="number" id="disennadorCI" class="form-control" name="cedula" placeholder="Ingrese cédula" >
                </div>
                <button type="button" id="buscarDisennador" class="btn btn-link fa fa-search"> Buscar diseñador</button>
              </div>
              <div class="form-label-group">
                <input type="text" id="disennador" class="form-control" placeholder="Diseño"   name="disennador">
                <label for="disennador">Diseñador curricular:</label>
              </div>
              <!-- boton para anhadir Disenadores -->
              <button type="button" class="btn btn-primary" onclick="addTable('d')">Agregar Diseñador</button>
              <!-- Tabla de Disenadores involucrados -->
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th scope="col">cedula</th>
                      <th scope="col">Nombre y Apellido</th>
                      <th scope="col">opciones</th>
                    </tr>
                  </thead>
                  <tbody id="tabla-Disenador">
                   
                  </tbody>
                </table>
              </div>
            </div>
            <div class="form-group">
              <label for="miembros">Miembros</label>
              <div class="form-group form-row">
                <div class="input-group-prepend">
                  <label class="input-group-text">Nacionalidad</label>
                </div>
                <div class="">
                  <select id="nacionalidad" name="nacionalidad" class="custom-select">
                    <option value="">...</option>
                    <option value="V">V</option>
                    <option value="E">E</option>
                  </select>
                </div>
                <div class="">
                  <input type="number" id="miembroCI" class="form-control" name="miembroCI" placeholder="Ingrese cedula" >
                </div>
                <button type="button" id="buscarMiembro" class="btn btn-link fa fa-search"> Buscar miembro</button>
              </div>
              <div class="form-label-group">
                  <input type="text" id="miembro" class="form-control" placeholder="Miembro Participante" name="disennador">
                  <label for="miembro">Miembro/Participante</label>
              </div>
              <!-- boton para anhadir Miembros -->
              <button type="button" class="btn btn-primary" onclick="addTable('m')">Agregar Diseñador</button>
              <!-- Tabla de Miembros involucrados -->
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th scope="col">cedula</th>
                      <th scope="col">Nombre y Apellido</th>
                      <th scope="col">opciones</th>
                    </tr>
                  </thead>
                  <tbody id="tabla-Miembro">
                    
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="form-group">
              <!-- <button id="myButton" type="button" class="btn btn-primary btn-block">+ Añadir Documento(s)</button> -->
              <!-- <form id="upload" enctype="multipart/form-data"> -->

                <fieldset>
                <!-- <legend>HTML File Upload</legend> -->
                
                <input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
                
                <div>
                    <span class="input-group-text">Documentos:</span>
                  <!-- <label for="fileselect">Files to upload:</label> -->
                  <input type="file" id="fileselect" name="fileselect[]" multiple="multiple" style="display:none"/>
                  <div id="filedrag"> 
                    <p>Presione para seleccionar archivos</p>
                    <p>   ó </p>
                      
                    <p>Arrástrelos aquí</p>
                    </div>
                </div>
                
                <!-- <div id="submitbutton">
                  <button type="submit">Upload Files</button>
                </div> -->
                
                </fieldset>
                
                <!-- </form> -->
                
                <div id="messages" >
                <p></p>
                </div>
            
              <script>
                // getElementById
                function $id(id) {
                  return document.getElementById(id);
                }
            
                //
                // output information
                function Output(msg) {
                  var m = $id("messages");
                  m.innerHTML = msg + m.innerHTML;
                }
                // call initialization file
                  if (window.File && window.FileList && window.FileReader) {
                    Init();
                  }
            
                  //
                  // initialize
                  function Init() {
            
                    var fileselect = $id("fileselect"),
                      filedrag = $id("filedrag"),
                      submitbutton = $id("submitbutton");
            
                    // file select
                    fileselect.addEventListener("change", FileSelectHandler, false);
            
                    // is XHR2 available?
                    var xhr = new XMLHttpRequest();
                    if (xhr.upload) {
                    
                      // file drop
                      filedrag.addEventListener("dragover", FileDragHover, false);
                      filedrag.addEventListener("dragleave", FileDragHover, false);
                      filedrag.addEventListener("drop", FileSelectHandler, false);
                      filedrag.style.display = "block";
                      
                      // remove submit button
                      submitbutton.style.display = "none";
                    }
            
                  }
            
                  // file drag hover
                function FileDragHover(e) {
                  e.stopPropagation();
                  e.preventDefault();
                  e.target.className = (e.type == "dragover" ? "hover" : "");
                }
            
                // file selection
                function FileSelectHandler(e) {
            
                // cancel event and hover styling
                FileDragHover(e);
                  console.log("Mi e------->",e)
                // fetch FileList object
                let files = e.target.files || e.dataTransfer.files;
                if(window.files===undefined|| window.files=== null){
                  window.files = [];

                }
                window.files = files;
                console.log("Mis files dropeadas ------>",files)
                // process all File objects
                $('#fileselect')[0].files = files;
                console.log("fileselect luego de soltar archivos---->",$('#fileselect')[0].files);
                }
                function ParseFile(file) {
            
                  Output(
                    "<p>Documento: <strong>" + file.name +
                    "</strong> tipo: <strong>" + file.type +
                    "</strong> tamaño: <strong>" + file.size +
                    "</strong> bytes</p>"
                  );
            
                  }
              </script>
              <script>
                  $(function(){
                      let inputFile = $('#fileselect');
                      let button = $('#filedrag');

                      button.click(function() {
                        inputFile.click();
                      });
                      
                  });
                
                </script>
                <div class="input-group mb-3">
                  
                  <div class="input-group-prepend">
                    
                  </div>
                  <div class="custom-file">                       
                  </div>
                </div>

              </div>
              <span id="errorPlace"></span>
              <hr>
            <input id="editButton" class="btn btn-primary btn-block" type="submit" value="Enviar" onclick="pressEnviar()">
          </form>
          <button class="btn btn-primary btn-block" onclick="enviarDatos()">prueba</button>


          <script>
            function pressEnviar(){
              console.log("hola", $('#fileselect')[0].files)
              console.log("hola", window)
              console.log("hola", window.File)
              console.log("Mis files al enviar", window.files)
              console.log("Solicitud", $('#solicitud')[0].value);

                if($('#fileselect')[0].files.length > 10){
                  alert("Excede el número de archivos permitido, máximo 10")
                }else{
                  let form = document.getElementById("myForm"),
                      formData = new FormData(form);
                  console.log("Las file drag----> ",$('#filedrag')[0].files)
                  fetch('/uploadSolicicitudAval', {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: formData
                  })
                    .then(function(response) {
                      if (response.status !== 200) {
                        console.log('Looks like there was a problem. Status Code: ' +
                          response.status);
                        return;
                      }
                      console.log("volvi")
                        
                    })
                    .catch(function(err) {
                        console.log("Fetch Error :-S", err);
                    });

                }
            }
          
          </script>

        </div>
        <!-- /.container-fluid -->

        <!-- Sticky Footer -->
        <footer class="sticky-footer">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright </span>
            </div>
          </div>
        </footer>

      </div>
      <!-- /.content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Listo para salir?</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">Seleccione "Salir" si está listo para terminar la sesión.</div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
            <a class="btn btn-primary" href="/logout">Salir</a>
          </div>
        </div>
      </div>
    </div>
    <style type="text/css">
    h1{
      text-align: center;
    }
    </style>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.js"></script>

    <script src="js/datatables.min.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/i18n/es.js"></script>

    <script src="js/reactive-fa-enviar.js"></script>
    <script src="js/buscarPersona/buscarPersona.js"></script>

    <!-- scripts para la insercion modificacion y eliminacion de las tablas -->

    <!-- variables globales que serviran para llevar la cuenta de los coordinadores, miembreos y disenhadores -->
    <script>
      var coord = 0;
      var dise = 0;
      var miembros = 0;
    </script>

    <script>
      // Esta funcion anhade items a las tablas de coordinador, disenador y miembros. 
      function addTable(opc) {
        
        let id;
        let tabla;
        let cedu;
        let nombre;
        let band = true;
        let nacionalidad;

        switch (opc) {
          case 'c':
            tabla =  document.getElementById("tabla-Coordinador");
            cedu = document.getElementById("coordinadorCI").value;
            nombre = document.getElementById("coordinador").value;
            nacionalidad = document.getElementById("coordinadorNAC").value;
            document.getElementById("coordinador").value = "";
            document.getElementById("coordinadorNAC").value = "";
            document.getElementById("coordinadorCI").value = "";
            if (nombre == '' || cedu == '' || nacionalidad == '') {
              alert('El campo Coordinado por, el campo Ingrese Cedula y el select de nacionalidad no puede estar vacio');
              band = false;
            }
            else{
              coord += 1;
              if (coord > 10) {
                alert("solo se permiten un maximo de 10 coordinadores.");
                coord -= 1;
                band = false;
              } 
              id = coord;
            } 
          break;
          case 'd':
            tabla =  document.getElementById("tabla-Disenador");
            cedu = document.getElementById("disennadorCI").value;
            nombre = document.getElementById("disennador").value;
            nacionalidad = document.getElementById("disennadorNAC").value;            
            document.getElementById("disennador").value = "";
            document.getElementById("disennadorNAC").value = "";
            document.getElementById("disennadorCI").value = "";
            if (nombre == '' || cedu == '' || nacionalidad == '') {
              alert('El campo Diseñador Curricular, el campo Ingrese Cedula y el select de nacionalidad no puede estar vacio');
              band = false;
            }
            else{
              dise += 1;
              if (dise > 10) {
                alert("solo se permiten un maximo de 10 diseñadores.");
                dise -= 1;
                band = false;
              } 
              id = dise;
            } 
          break;
          case 'm':
            tabla =  document.getElementById("tabla-Miembro");
            cedu = document.getElementById("miembroCI").value;
            nombre = document.getElementById("miembro").value;
            nacionalidad = document.getElementById("nacionalidad").value;
            document.getElementById("miembro").value = "";
            document.getElementById("nacionalidad").value = "";
            document.getElementById("miembroCI").value = "";
            if (nombre == '' || cedu == '' || nacionalidad == '') {
              alert('El campo Miembro/Participante, el campo Ingrese Cedula y el select de nacionalidad no puede estar vacio ');
              band = false;
            }
            else{
              miembros += 1;
              if (miembros > 10) {
                alert("solo se permiten un maximo de 10 miembros/participantes.");
                miembros -= 1;
                band = false;
              }
              id = miembros;
            }
          break;
        }
        if (band) {
          const code ='<tr id="'+ opc + id +'">' 
                     +'<td id="cedu' + opc + id + '">' + nacionalidad + '-' + cedu + '</td>'
                     + '<td id="nomb' + opc + id + '">' + nombre + ' </td>'
                     + '<td>'
                     + '<button type="button" class="btn btn-outline-primary" onclick="deleteTable(\''+ opc + id +'\', \'' + opc + '\')">Eliminar</button>'
                     + '</td>'
                     + '</tr>'; 

          tabla.insertAdjacentHTML('beforeend', code);  
        }
             
      }

     

      function enviarDatos() {

        if (coord == 0 || dise == 0 || miembros == 0) {

          alert('Asegurese haber añadido por lo menos 1 coordinador, 1 diseñador y 1 miembro/participante ')
          
        } else {
            /*************************CARGA DATOS DE LAS TABLAS EN ARRAYS DE JSON***************************************************************/
            const tablaC = document.getElementById('tabla-Coordinador');
            const tablaD = document.getElementById('tabla-Disenador');
            const tablaM = document.getElementById('tabla-Miembro');

            let datosC = []; //datos tabla coordinador
            let datosD = []; //datos tabla disennador
            let datosM = []; //datos tabla miembro

            let persona = new Object();

            for (let i = 0; i < tablaC.rows.length; i++) {
              persona['cedula'] = tablaC.rows[i].getElementsByTagName('td')[0].innerText;
              persona['nombre'] = tablaC.rows[i].getElementsByTagName('td')[1].innerText;
              datosC[i] = persona;
            }
          
            for (let i = 0; i < tablaD.rows.length; i++) {
              persona['cedula'] = tablaD.rows[i].getElementsByTagName('td')[0].innerText;
              persona['nombre'] = tablaD.rows[i].getElementsByTagName('td')[1].innerText;
              datosD[i] = persona;
            }
          
            for (let i = 0; i < tablaM.rows.length; i++) {
              persona['cedula'] = tablaM.rows[i].getElementsByTagName('td')[0].innerText;
              persona['nombre'] = tablaM.rows[i].getElementsByTagName('td')[1].innerText;
              datosM[i] = persona;
            }
          
          /*************************CARGA DATOS DE LAS TABLAS EN ARRAYS DE JSON***************************************************************/

        }


        
      }
    </script>

    <script>
     function deleteTable(id, opc){
        console.log(opc);
        const elemento = document.getElementById(id);
        elemento.parentNode.removeChild(elemento);

        switch (opc) {
          case 'c':
            coord -= 1; 
            console.log('pase por aqui'); 
          break;
          case 'd':
            dise -= 1;  
          break;
          case 'm':
            miembros -= 1;  
          break;
      
        }

      }
    </script>


  </body>

</html>
